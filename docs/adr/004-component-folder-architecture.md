# ADR-004: Component Folder Architecture — Private Routes, Shared UI Layers

**Status:** Accepted
**Date:** 2026-02-05
**Authors:** Celsius Aray

## Context

As the dashboard grew from a single overview page to four routes (Overview, Releases, Fans, Settings) with shared layout components, charts, cards, and forms, we needed a clear convention for where components live and when they should move between layers.

Without a convention, components tend to accumulate in a flat `components/` directory, making it unclear which are reusable, which are page-specific, and which are third-party primitives that shouldn't be modified.

### Options Considered

1. **Flat `components/` folder** — All components at the same level. Simple but doesn't scale; hard to distinguish primitives from custom components.
2. **Feature-based folders** (`features/releases/components/`) — Groups by domain. Good for large apps but creates duplication for shared UI elements.
3. **Layered architecture** — Separate primitives, custom components, and route-specific compositions into distinct directories with clear promotion rules.

## Decision

Use **Option 3**: A layered component architecture with three tiers:

### Tier 1: Primitives (`src/components/ui/core/`)

- **Source:** Generated by `npx shadcn@latest add <component>`
- **Rule:** Never modify directly. If customization is needed, wrap in a Tier 2 component.
- **Examples:** `button.tsx`, `card.tsx`, `dropdown-menu.tsx`, `dialog.tsx`, `avatar.tsx`
- **Alias:** `components.json` maps `ui` → `@/components/ui/core`

### Tier 2: Custom Design System (`src/components/ui/customs/{category}/`)

- **Categories:** `cards/`, `charts/`, `feedback/`, `lists/`, `forms/`
- **Rule:** Domain-aware components built on Tier 1 primitives. Shared across 2+ routes.
- **Examples:** `MetricCard.tsx`, `RevenueChart.tsx`, `TopFans.tsx`, `ReleaseUploadDialog.tsx`

### Tier 3: Route Compositions (`src/app/[locale]/{route}/_components/`)

- **Convention:** `_components/` prefix (Next.js private folder — not exposed as routes)
- **Rule:** Components used by only one route. Promoted to Tier 2 when reused elsewhere.
- **Examples:** `HomePageStreaming.tsx`, `FansPageContent.tsx`, `SettingsPageClient.tsx`

### Shared Layout (`src/components/layout/`)

- Shell components used across the entire app: `Sidebar.tsx`, `MobileBottomNav.tsx`, `DashboardHeader.tsx`, `LanguageSelector.tsx`

### Other Directories

- `src/hooks/` — Custom hooks (`useApiData`, `useSidebar`)
- `src/components/motion/` — Animation utilities using Motion library
- `src/components/audio/` — Audio system (`AudioWaveform.tsx`)
- `src/store/` — Zustand stores (player state)

### Promotion Rule

A component starts in Tier 3 (`_components/`). When a second route needs it, it moves to Tier 2 (`ui/customs/`). This prevents premature abstraction while keeping the shared component library intentional.

## Consequences

- **Positive:** Clear ownership boundaries; shadcn/ui components are never accidentally modified; the `_components/` convention is standard Next.js (recognized by the framework, excluded from routing); new developers can find components by looking at the route directory first.
- **Negative:** The three-tier system requires discipline to maintain; components can end up in the wrong tier if the promotion rule isn't followed consistently.
- **Trade-off:** The `ui/customs/` subcategories (`cards/`, `charts/`, etc.) add nesting depth, but the categorization makes large component sets navigable.

### Directory Tree

```
src/
├── components/
│   ├── ui/core/          # Tier 1: shadcn primitives (read-only)
│   ├── ui/customs/       # Tier 2: custom design system
│   │   ├── cards/        #   MetricCard, ReleaseCard
│   │   ├── charts/       #   RevenueChart, FanGrowthChart
│   │   ├── feedback/     #   Skeletons, empty states
│   │   ├── lists/        #   TopFans, ReleasesGrid, RecentReleasesList
│   │   └── forms/        #   TrackListEditor, ReleaseUploadDialog
│   ├── layout/           # Shell: Sidebar, Header, MobileNav
│   ├── motion/           # Animation wrappers
│   └── audio/            # Audio waveform system
├── app/[locale]/
│   ├── _components/      # Tier 3: overview-specific
│   ├── releases/_components/  # Tier 3: releases-specific
│   ├── fans/_components/      # Tier 3: fans-specific
│   └── settings/_components/  # Tier 3: settings-specific
```
